{% extends 'iris_app/base.html' %}
{% load static %}

{% block title %}Iris Samples - Management System{% endblock %}

{% block content %}

<h1 style="display: flex; align-items: center; gap: 10px;">
    <img src="{% static 'images/stock-market.png' %}" alt="Iris Icon" style="width: 35px; height: 35px;">
    Iris Data List
</h1>

<div class="div-info">
    <h3 style="display: flex; align-items: center; gap: 10px; margin-top: 0;">
        <img src="{% static 'images/warning.png' %}" alt="Species Icon" style="width: 28px; height: 28px;" onerror="this.style.display='none'">
        Species Information
    </h3>
    <p>This project uses the <a href="https://archive.ics.uci.edu/ml/datasets/iris" target="_blank">UCI Iris Dataset</a>. Total <strong>{{ total_count }}</strong> Iris samples are stored in the system.</p>
</div>

<div class="div-section">
    <h2 style="display: flex; align-items: center; gap: 10px; margin-top: 0;">
        <img src="{% static 'images/flower.png' %}" alt="Species Icon" style="width: 28px; height: 28px;" onerror="this.style.display='none'">
        Iris Species
    </h2>
    <div class="gallery">
        <div style="text-align: center;">
            <img src="{% static 'images/setosa.jpg' %}" alt="Iris Setosa - Small purple flower with short petals" style="width: 100%; height: 200px; object-fit: cover;">
            <h3>Iris Setosa</h3>
            <p style="font-size: 0.9rem;">Small flowers with short petals. Easily distinguishable from other species.</p>
        </div>
        <div style="text-align: center;">
            <img src="{% static 'images/versicolor.jpeg' %}" alt="Iris Versicolor - Medium purple flower with medium petals" style="width: 100%; height: 200px; object-fit: cover;">
            <h3>Iris Versicolor</h3>
            <p style="font-size: 0.9rem;">Medium-sized flowers with medium-length petals. Variable characteristics.</p>
        </div>
        <div style="text-align: center;">
            <img src="{% static 'images/virginia.jpeg' %}" alt="Iris Virginica - Large purple flower with long petals" style="width: 100%; height: 200px; object-fit: cover;">
            <h3>Iris Virginica</h3>
            <p style="font-size: 0.9rem;">Larger flowers with longer petals. Most elegant of the three species.</p>
        </div>
    </div>
</div>

<div class="div-section">
    <h2 style="display: flex; align-items: center; gap: 10px; margin-top: 0;">
        <img src="{% static 'images/call-to-action.png' %}" alt="Actions Icon" style="width: 28px; height: 28px;" onerror="this.style.display='none'">
        Actions
    </h2>
    <div class="btn-group">
        <a href="{% url 'iris_search' %}" class="btn" style="display: inline-flex; align-items: center; gap: 8px;">
            <img src="{% static 'images/searchs.png' %}" alt="CSV" style="width: 20px; height: 20px;" onerror="this.style.display='none'">
            Advanced Search
        </a>
        <a href="{% url 'iris_predict' %}" class="btn" style="display: inline-flex; align-items: center; gap: 8px;">
            <img src="{% static 'images/machine-learning.png' %}" alt="CSV" style="width: 20px; height: 20px;" onerror="this.style.display='none'">
            ML Prediction
        </a>
        {% if is_editor %}
            <a href="{% url 'export_csv' %}" class="btn" style="display: inline-flex; align-items: center; gap: 8px;">
                <img src="{% static 'images/share.png' %}" alt="CSV" style="width: 20px; height: 20px;" onerror="this.style.display='none'">
                Export CSV
            </a>
            <a href="{% url 'iris_create' %}" class="btn" style="display: inline-flex; align-items: center; gap: 8px;">
                <img src="{% static 'images/new.png' %}" alt="CSV" style="width: 20px; height: 20px;" onerror="this.style.display='none'">
                Add New Iris
            </a>
            <a href="{% url 'import_csv' %}" class="btn" style="display: inline-flex; align-items: center; gap: 8px;">
                <img src="{% static 'images/inbox.png' %}" alt="CSV" style="width: 20px; height: 20px;" onerror="this.style.display='none'">
                Import CSV
            </a>
        {% endif %}
    </div>
</div>

<div class="div-highlight">
    <h3 style="display: flex; align-items: center; gap: 10px; margin-top: 0;">
        <img src="{% static 'images/notepad.png' %}" alt="Actions Icon" style="width: 28px; height: 28px;" onerror="this.style.display='none'">
        Actions
    </h3>
    <p>Below are all registered Iris samples. Click the links to view details, edit, or delete records.</p>
</div>

{% if samples %}
    <table>
        <thead>
            <tr>
                <th>Species</th>
                <th>Sepal (cm)</th>
                <th>Petal (cm)</th>
                <th>Laboratory</th>
                <th>Date</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for sample in samples %}
            <tr>
                <td><strong>{{ sample.get_species_display }}</strong></td>
                <td>
                    <ul style="margin: 0; list-style: none; padding: 0; font-size: 0.9rem;">
                        <li style="margin-bottom: 4px; display: flex; align-items: center;">
                            <span style="font-weight: bold; color: #2c3e50; width: 20px;">L:</span> 
                            <span style="background-color: #e8f6f3; padding: 2px 6px; border-radius: 4px; color: #16a085;">
                                {{ sample.sepal_length }} cm
                            </span>
                        </li>
                        <li style="display: flex; align-items: center;">
                            <span style="font-weight: bold; color: #2c3e50; width: 20px;">W:</span> 
                            <span style="background-color: #fef9e7; padding: 2px 6px; border-radius: 4px; color: #d4ac0d;">
                                {{ sample.sepal_width }} cm
                            </span>
                        </li>
                    </ul>
                </td>
                <td>
                    <ul style="margin: 0; list-style: none; padding: 0; font-size: 0.9rem;">
                        <li style="margin-bottom: 4px; display: flex; align-items: center;">
                            <span style="font-weight: bold; color: #2c3e50; width: 20px;">L:</span> 
                            <span style="background-color: #e8f6f3; padding: 2px 6px; border-radius: 4px; color: #16a085;">
                                {{ sample.petal_length }} cm
                            </span>
                        </li>
                        <li style="display: flex; align-items: center;">
                            <span style="font-weight: bold; color: #2c3e50; width: 20px;">W:</span> 
                            <span style="background-color: #fef9e7; padding: 2px 6px; border-radius: 4px; color: #d4ac0d;">
                                {{ sample.petal_width }} cm
                            </span>
                        </li>
                    </ul>
                </td>
                <td>{{ sample.lab.name|default:"N/A" }}</td>
                <td>{{ sample.created_at|date:"d/m/Y H:i" }}</td>
                <td>
                    <div class="table-actions">
                        <a href="{% url 'iris_detail' sample.pk %}" class="edit">View</a>
                        {% if is_editor %}
                            {% if sample.created_by == user or user.is_superuser %}
                                <a href="{% url 'iris_update' sample.pk %}" class="edit">Edit</a>
                                <a href="{% url 'iris_delete' sample.pk %}" class="delete">Delete</a>
                            {% endif %}
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <div class="div-danger">
        <h3>⚠️ No Data Found</h3>
        <p>No Iris samples have been recorded yet. 
        {% if is_editor %}
            <a href="{% url 'iris_create' %}">Add a new record</a> or <a href="{% url 'import_csv' %}">import a CSV file</a>.
        {% else %}
            Wait for an authorized user to add data.
        {% endif %}
        </p>
    </div>
{% endif %}

<div class="div-section" style="margin-top: 30px;">
    <h2 style="display: flex; align-items: center; gap: 10px; margin-top: 0;">
        <img src="{% static 'images/bar-chart.png' %}" alt="Actions Icon" style="width: 28px; height: 28px;" onerror="this.style.display='none'">
        Statistics
    </h2>
    <ul>
        <li><strong>Total Iris Samples:</strong> {{ total_count }}</li>
        <li><strong>Your Records:</strong> {{ user.irisplant_set.count }}</li>
        <li><strong>Available Species:</strong> 
            {% for species, display_name in species_types.items %}
                <span style="background: #ecf0f1; padding: 4px 8px; border-radius: 4px; margin: 2px;">{{ display_name }}</span>
            {% endfor %}
        </li>
    </ul>
</div>

<div class="div-section">
    <h2 style="display: flex; align-items: center; gap: 10px; margin-top: 0;">
        <img src="{% static 'images/hyperlink.png' %}" alt="Actions Icon" style="width: 28px; height: 28px;" onerror="this.style.display='none'">
        Quick Links
    </h2>
    <ol>
        {% if is_editor %}
            <li><a href="{% url 'iris_create' %}">Add New Iris Sample</a></li>
            <li><a href="{% url 'import_csv' %}">Import From CSV File</a></li>
        {% endif %}
        <li><a href="{% url 'iris_search' %}">Search Iris Samples</a></li>
        <li><a href="{% url 'iris_predict' %}">Predict With Machine Learning</a></li>
        <li><a href="https://archive.ics.uci.edu/ml/datasets/iris" target="_blank">Original UCI Dataset</a></li>
    </ol>
</div>

{% endblock %}